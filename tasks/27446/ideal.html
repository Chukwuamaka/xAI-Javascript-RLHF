<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The 1024 Game</title>
<style>
    body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #fff;
        font-family: Arial, sans-serif;
        padding: 0;
        margin: 0;
    }
    #game-title {
        font-weight: 700;
        color: black;
        margin-bottom: 5em;
    }
    #game-board {
        width: 400px;
        height: 400px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(4, 1fr);
        gap: 1px;
        background: #bbada0;
        border-radius: 6px;
    }
    .tile {
        width: 100px;
        height: 100px;
        background: #cdc1b4;
        border: 2px solid black;
        border-radius: 3px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 25px;
        font-weight: bold;
        transition: 100ms ease-in-out;
    }
    #score, #game-over {
        text-align: center;
        margin-bottom: 20px;
    }
    #game-over {
        display: none;
    }
    .new, .merged {
        animation: pop 0.3s;
    }
    @keyframes pop {
        0% { transform: scale(0); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
    }
</style>
</head>
<body>
<h2 id="game-title">The 1024 Game</h2>
<div id="score">Score: <span id="current-score">0</span></div>
<div id="game-board"></div>
<div id="game-over">
    <h2>Game Over!</h2>
    <button onclick="startGame()">Try Again</button>
</div>

<script>
    const boardSize = 4;
    let board = Array(boardSize).fill().map(() => Array(boardSize).fill(0));
    let score = 0;
    let gameWon = false;

    function startGame() {
        board = Array(boardSize).fill().map(() => Array(boardSize).fill(0));
        score = 0;
        gameWon = false;
        document.getElementById('current-score').innerText = score;
        document.getElementById('game-over').style.display = 'none';
        addNewTile(); 
        renderBoard();
    }

    function addNewTile() {
        let emptyCells = [];
        for(let i = 0; i < boardSize; i++) {
            for(let j = 0; j < boardSize; j++) {
                if(board[i][j] === 0) emptyCells.push({x: i, y: j});
            }
        }
        if(emptyCells.length > 0) {
            const spot = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            board[spot.x][spot.y] = Math.random() < 0.9 ? 2 : 4;
        }
    }

    function renderBoard() {
        const gameBoard = document.getElementById('game-board');
        gameBoard.innerHTML = '';
        board.forEach((row, x) => {
            row.forEach((value, y) => {
                const tile = document.createElement('div');
                tile.className = 'tile';
                if (value > 0) {
                    tile.innerText = value;
                    tile.style.background = getTileColor(value);
                    if(value === 2 || value === 4) tile.classList.add('new');
                }
                gameBoard.appendChild(tile);
            });
        });
    }

    function getTileColor(value) {
        const colors = {2: '#eee4da', 4: '#ede0c8', 8: '#f2b179', 16: '#f59563', 32: '#f67c5f', 64: '#f65e3b', 128: '#edcf72', 256: '#edcc61', 512: '#edc850', 1024: '#edc53f'};
        return colors[value] || '#edc22e';
    }

    function move(direction) {
        let hasMoved = false;
        let merged = Array(boardSize).fill().map(() => Array(boardSize).fill(false));

        if(direction === 'left' || direction === 'right') {
            for(let i = 0; i < boardSize; i++) {
                let row = board[i].slice(); 
                if(direction === 'right') row.reverse();

                let newRow = slideAndMerge(row, merged[i]);

                if(direction === 'right') newRow.reverse();
                if(board[i].join() !== newRow.join()) hasMoved = true;
                board[i] = newRow;
            }
        } else if(direction === 'up' || direction === 'down') {
            for(let j = 0; j < boardSize; j++) {
                let column = board.map(row => row[j]);
                if(direction === 'down') column.reverse();

                let newColumn = slideAndMerge(column, merged.map(row => row[j]));

                if(direction === 'down') newColumn.reverse();
                if(board.map(row => row[j]).join() !== newColumn.join()) hasMoved = true;
                for(let i = 0; i < boardSize; i++) board[i][j] = newColumn[i];
            }
        }

        if(hasMoved) {
            addNewTile();
            renderBoard();
            document.getElementById('current-score').innerText = score;
            checkGameOver();
        }
    }

    function slideAndMerge(line, mergedLine) {
        let newLine = line.filter(val => val);
        let missing = boardSize - newLine.length;
        newLine = newLine.concat(Array(missing).fill(0));

        for(let i = 0; i < newLine.length - 1; i++) {
            if(newLine[i] === newLine[i + 1] && newLine[i] !== 0 && !mergedLine[i] && !mergedLine[i + 1]) {
                newLine[i] *= 2;
                score += newLine[i];
                newLine[i + 1] = 0;
                mergedLine[i] = true;
            }
        }

        return newLine.filter(val => val).concat(Array(missing).fill(0));
    }

    function checkGameOver() {
        let gameOver = true;
        for(let i = 0; i < boardSize; i++) {
            for(let j = 0; j < boardSize; j++) {
                if(board[i][j] === 0 || 
                   (j < boardSize - 1 && board[i][j] === board[i][j+1]) || 
                   (i < boardSize - 1 && board[i][j] === board[i+1][j])) {
                    gameOver = false;
                    break;
                }
            }
            if(!gameOver) break;
        }
        if(gameOver) {
            document.getElementById('game-over').style.display = 'block';
        }
    }

    document.addEventListener('keydown', function(e) {
        switch(e.key) {
            case 'ArrowLeft': move('left'); break;
            case 'ArrowRight': move('right'); break;
            case 'ArrowUp': move('up'); break;
            case 'ArrowDown': move('down'); break;
        }
    });

    startGame();
</script>

</body>
</html>
